!function($,window,document,undefined){function Plugin(t,e){var r=arguments.length,a=arguments[1];return 1===r&&(a="object"===$.type(arguments[0])?arguments[0]:{}),this.each(function(){var e=$(this),r=e.data("WEB.dataTable"),s=$.extend({},DataTable.DEFAULTS,e.data(),a);r||e.data("WEB.dataTable",r=new DataTable(this,s)),"string"===$.type(t)&&"_"!=t.charAt(0)?r[t]?r[t](s):$.error("不支持的方法！"):r.init(s)})}$.extend({isBrowerSupportWebPlugin:function(){var t=!1,e="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,""),r=["MSIE8.0","MSIE7.0","MSIE6.0","MSIE5.0"];return $.each(r,function(r,a){if(e==a)return alert("您的浏览器版本过低，本插件无法提供支持，请升级！"),t=!1,!1;t=!0}),t}});var DataTable=function(t,e){this.$element=$(t),this.options=e};DataTable.VERSION="1.0.2",DataTable.DEFAULTS={isFilter:!0,data:[],sortColumns:[],filterColumns:[],beforeSort:$.noop(),afterSort:$.noop,ignoreKey:[],filterContainer:$("body"),emptyFilter:function(){}},DataTable.prototype={init:function(t){"array"==$.type(t.data)?0!=t.data.length?(this.create(t),this._filterSource(t),this._filterColumns(t)):alert("数据源不能为空！"):alert("数据源必须为数组！")},destroy:function(){this.$element.find("thead:first >tr > th").removeClass("WEB_sortByDesc WEB_sortByAsc WEB_activeSort WEB_sort"),this.$element.removeData("WEB.dataTable")},create:function(t){if(1!=t.data.length){var e=this.$element.find("thead:first >tr > th"),r=this;e.length>0&&e.each(function(e,a){var s=t.sortColumns[e];if(s){var i=s.sort,o=s.isPrimaryKey;if(i&&$(this).addClass("WEB_sort"),o){r.clear(),$(this).addClass("WEB_sortBy"+s.type).addClass("WEB_activeSort");var l=$(this).hasClass("WEB_sortByDesc");r.sort(t,l)}}}),this.event(t)}else t.afterSort.call(this,{relatedTarget:t,sortedData:t.data})},event:function(t){var e=this;this.$element.off("click").on("click",".WEB_sort",function(){t.beforeSort.call(e,{relatedTarget:t}),e.switch($(this),t)})},clear:function(){$(".WEB_sort").removeClass("WEB_sortByDesc WEB_sortByAsc WEB_activeSort")},sort:function(_relatedTarget,isDesc){var i=$(".WEB_activeSort").index()||0,_this=this,sortCol=_relatedTarget.sortColumns[i],sourceData=_relatedTarget.source?_relatedTarget.source:_relatedTarget.data;if(sortCol){var sortKey=sortCol.key,sortedData=sourceData.sort(function(a,b){var aSortKey,bSortKey,keyType;if("object"===$.type(sortKey)?"array"===sortKey.type&&(aSortKey=a[sortKey.objKey][sortKey.index][sortKey.orderKey],bSortKey=b[sortKey.objKey][sortKey.index][sortKey.orderKey]):(aSortKey=eval("a."+sortKey),bSortKey=eval("b."+sortKey)),aSortKey=$.trim(aSortKey),bSortKey=$.trim(bSortKey),keyType=$.type(aSortKey),!$.isNumeric(aSortKey)&&"string"===keyType){var isDate=/\d{4}([-\/])\d{1,2}([-\/])\d{1,2}(\s{1}\d{1,2}:\d{1,2}(:\d{1,2})?)?/g;if(!isDate.test(aSortKey))return isDesc?bSortKey.localeCompare(aSortKey):aSortKey.localeCompare(bSortKey);aSortKey=Date.parse(aSortKey.replace(/-/g,"/")),bSortKey=Date.parse(bSortKey.replace(/-/g,"/"))}return isDesc?bSortKey-aSortKey:aSortKey-bSortKey});_relatedTarget.afterSort.call(_this,{relatedTarget:_relatedTarget,sortedData:sortedData})}},switch:function(t,e){var r=t.hasClass("WEB_sortByDesc");this.clear(),t.addClass("WEB_activeSort"),r?t.removeClass("WEB_sortByDesc").addClass("WEB_sortByAsc"):t.removeClass("WEB_sortByAsc").addClass("WEB_sortByDesc"),r=!r,this.sort(e,r)},_filterSource:function(t){function e(t,e){var r=[];return $.each(t,function(t,a){if(a){var s=0,i=JSON.stringify(a),o=e.split(" ");$.each(o,function(t,e){new RegExp(e,"gi").test(i)&&s++}),s===o.length&&i&&-1===$.inArray(i,r)&&r.push(i)}}),r}function r(t){var e=[];return $.each(t,function(t,r){e.push($.parseJSON(r))}),e}if(t.isFilter){var a=$("#WEB_dataTable_filter"),s=this,i=t.data;0===a.length&&(t.filterContainer.append('<input type="txt" class="WEB_dataTable_filter" id="WEB_dataTable_filter" />'),a=$("#WEB_dataTable_filter")),a.off("input").on("input",function(){var a=$(this).val();t.source=null;var o=r(e(i,a));if($.isEmptyObject(o))t.emptyFilter.call(s);else{var l=$(".WEB_activeSort").hasClass("WEB_sortByDesc");t.source=o,s.sort(t,l)}})}},_filterColumns:function(_relatedTarget){function recursion(data,w,keyInd){var res=[],filterKey=_relatedTarget.filterColumns[keyInd].key;return console.log(filterKey),$.each(data,function(i,d){if(d){var matchCount=0,targetData=eval("d."+filterKey),dataStr=JSON.stringify(targetData),words=w.split(" ");$.each(words,function(t,e){new RegExp(e,"gi").test(dataStr)&&matchCount++}),matchCount===words.length&&dataStr&&-1===$.inArray(dataStr,res)&&res.push(d)}}),res}var _this=this,filterColumnsData=_relatedTarget.filterColumns,isFilterByColumns=this._affirmFilterByColumns(filterColumnsData),source=_relatedTarget.data;if(isFilterByColumns){this.$element.find("thead:first tr.WEB_dataTable_filterColumns").remove();var filterInput=[];$.each(filterColumnsData,function(t,e){var r="<th>"+(e.filter?'<input type="text" class="WEB_dataTable_filterKey" />':'<input type="text" class="WEB_dataTable_filterKey WEB_dataTable_filterDisabled" disabled />')+"</th>";filterInput.push(r)}),filterInput.unshift('<tr class="WEB_dataTable_filterColumns">'),filterInput.push("</tr>");var filterColumnsTr=filterInput.join("");this.$element.find("thead:first").append(filterColumnsTr),filterColumnsTr=this.$element.find("thead:first tr.WEB_dataTable_filterColumns"),filterColumnsTr.off("input").on("input",".WEB_dataTable_filterKey",function(t){var e=$(this).val(),r=$(this).parent().index();_relatedTarget.source=null;var a=recursion(source,e,r);if($.isEmptyObject(a))_relatedTarget.emptyFilter.call(_this);else{var s=$(".WEB_activeSort").hasClass("WEB_sortByDesc");_relatedTarget.source=a,_this.sort(_relatedTarget,s)}})}},_affirmFilterByColumns:function(t){var e=!1;return $.each(t,function(t,r){if(r.filter)return e=!0,!1}),e}};var old=$.fn.WEB_dataTable;$.isBrowerSupportWebPlugin()&&($.fn.WEB_dataTable=Plugin,$.fn.WEB_dataTable.Constructor=DataTable,$.fn.WEB_dataTable.noConflict=function(){return $.fn.WEB_dataTable=old,this})}(jQuery,window,document);