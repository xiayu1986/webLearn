!function($,window,document,undefined){var defaults={isInitTree:!0,textConf:{format:"格式化",compress:"压缩",treeView:"生成树",empty:"清空",root:"根节点",placeholder:"请在此输入您的数据"},indentClass:4,lineBreak:"\n"},methods={init:function(t){return this.each(function(){var e=$(this).data("WEB_format_settings");e?this.settings=$.extend(!0,{},e,t):(this.settings=$.extend(!0,{},defaults,t),$(this).data("WEB_format_settings",this.settings)),methods._createFormatContainer.call(this)})},_createFormatContainer:function(){var t=$(this).find(".WEB_format_container");if(!(t.length>0)){var e='<div class="WEB_format_container"><div class="WEB_format_tree"></div><div class="WEB_format_source"><div class="WEB_format_option"><div class="actionBtn format">'+this.settings.textConf.format+'</div><div class="actionBtn compress">'+this.settings.textConf.compress+'</div><div class="actionBtn treeView">'+this.settings.textConf.treeView+'</div><div class="actionBtn empty">'+this.settings.textConf.empty+'</div></div><div class="WEB_format_data"><textarea class="WEB_format_area" placeholder="'+this.settings.textConf.placeholder+'"></textarea></div><div class="WEB_format_message"></div></div></div>';$(this).html(e),methods._createFormatEvents.call(this)}},_createFormatEvents:function(){var t=$(this).find(".WEB_format_area"),e=$(this).find(".WEB_format_tree"),a=$(this).find(".WEB_format_message"),s=this;$(this).off(".format").on("click.format",".actionBtn",function(){if($(this).hasClass("empty"))t.val(""),e.html(""),a.html("");else{var r=t.val(),i=!!$(this).hasClass("compress"),o=methods._checkOutJson.call(s,r);if("object"!==$.type(o))return;$(this).hasClass("treeView")?methods._createTreeView.call(s,o.data):methods._formatData.call(s,o.data,i)}}),t.on("input keyup",function(){var e=t.val(),a=methods._checkOutJson.call(s,e);"object"===$.type(a)&&methods._createTreeView.call(s,a.data)})},_formatData:function(t,e){for(var a="",s=0;s<this.settings.indentClass;s++)a+=" ";var r=[],i=this.settings.lineBreak,o=0,n=0,c=[],l=$(this).find(".WEB_format_message"),h=$(this).find(".WEB_format_area");e&&(i=a="");var f=function(t,e,s,l,h){o++;for(var m=0,d="";m<l;m++)d+=a;if(n=++l,c.push(n),"array"===$.type(e)){r.push(d+(h?'"'+t+'":':"")+"["+i);for(var u=0;u<e.length;u++)f(u,e[u],u==e.length-1,l,!1);r.push(d+"]"+(s?i:","+i))}else if("object"===$.type(e)){r.push(d+(h?'"'+t+'":':"")+"{"+i);var p=0,v=0;for(var _ in e)p++;for(var g in e)f(g,e[g],++v==p,l,!0);r.push(d+"}"+(s?i:","+i))}else"string"==$.type(e)&&(e='"'+e+'"'),r.push(d+(h?'"'+t+'":':"")+e+(s?"":",")+i)};f("",t,!0,0,!1),n=Math.max.apply(null,c),l.html("共处理节点<b>"+o+"</b>个,最大节点深度为<b>"+n+"</b>"),h.val(r.join(""))},_checkOutJson:function(sourceData){var message=$(this).find(".WEB_format_message"),jsonRule=/^\s*\[|\{(\n*.*)*\s*$/g;if(""===sourceData)return message.html("数据不能为空！"),!1;if(!jsonRule.test(sourceData))return message.html("数据格式不匹配！"),!1;message.html("");try{sourceData=eval("("+sourceData+")")}catch(t){return message.html("数据格式化出错！"),!1}return message.html(""),{result:!0,data:sourceData}},_createTreeView:function(t){var e=[],a=function(t,s,r,i,o){var n=this,c=0,l=""===t||s?"tree-icon tree-icon-root":"tree-icon tree-icon-close";if("array"===$.type(i)?c=i.length:"object"===$.type(i)&&$.each(i,function(){c++}),"root"===r&&e.push('<ul class="root-tree">'),e.push('<li class="root-tree-items">'),"object"==typeof i){e.push('<div class="node-name">',methods._createTreeIcon.call(n,t,l,"tree-icon tree-icon-"+$.type(i),r,""),"</div>"),e.push('<ul class="node-tree">');var h=0,f=!1,m=!1;$.each(i,function(e,r){"array"===$.type(i)?f=e===c-1:"object"===$.type(i)&&(h++,m=!0,f=h===c),a(t+methods._createPrefixIcon(""===t?"tree-icon":s?"tree-icon":"tree-icon tree-icon-line"),f,e,r,m)}),e.push("</ul>")}else e.push('<div class="node-name">',methods._createTreeIcon.call(n,t,s?"tree-icon tree-icon-end":"tree-icon tree-icon-join",o?"tree-icon tree-icon-default":"tree-icon tree-icon-number",r,i),"</div>");e.push("</li>"),"root"===r&&e.push("</ul>")};return $.isEmptyObject(t)?void $(this).find(".WEB_format_message").html("无法绘制空对象！"):(a("",!0,"root",t,!1),void $(this).find(".WEB_format_tree").html(e.join("")))},_createTreeIcon:function(t,e,a,s,r){return r&&"string"===$.type(r)&&(r='"'+r+'"'),t+methods._createPrefixIcon(e)+methods._createPrefixIcon(a)+s+(""===r?"":":")+r},_createPrefixIcon:function(t){return'<span class="'+t+'"></span>'}};$.fn.WEB_format=function(){var t="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"");if("MSIE7.0"==t||"MSIE6.0"==t||"MSIE5.0"==t)return void alert("您的浏览器版本过低，本插件无法提供支持，请升级！");var e,a=arguments[0];if(methods[a]&&"_"!=a.charAt(0))a=methods[a],e=Array.prototype.slice.call(arguments,1);else{if("object"!=typeof a&&a)return $.error("方法未正确调用"),this;a=methods.init,e=arguments}return a.apply(this,e)}}(jQuery,window,document);