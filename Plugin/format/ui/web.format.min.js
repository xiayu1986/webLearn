!function($,window,document,undefined){var defaults={isInitTree:!0,textConf:{format:"格式化",compress:"压缩",treeView:"生成树",empty:"清空",root:"根节点",placeholder:"请在此输入您的数据"},indentClass:4,lineBreak:"\n"},methods={init:function(t){return this.each(function(){var e=$(this).data("WEB_format_settings");e?this.settings=$.extend(!0,{},e,t):(this.settings=$.extend(!0,{},defaults,t),$(this).data("WEB_format_settings",this.settings)),methods._createFormatContainer.call(this)})},_createFormatContainer:function(){var t=$(this).find(".WEB_format_container");if(!(t.length>0)){var e='<div class="WEB_format_container">\t\t\t\t\t\t\t<div class="WEB_format_tree"></div>\t\t\t\t\t\t\t<div class="WEB_format_source">\t\t\t\t\t\t\t\t<div class="WEB_format_option">\t\t\t\t\t\t\t\t\t<div class="actionBtn format">'+this.settings.textConf.format+'</div>\t\t\t\t\t\t\t\t\t<div class="actionBtn compress">'+this.settings.textConf.compress+'</div>\t\t\t\t\t\t\t\t\t<div class="actionBtn treeView">'+this.settings.textConf.treeView+'</div>\t\t\t\t\t\t\t\t\t<div class="actionBtn empty">'+this.settings.textConf.empty+'</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="WEB_format_data">\t\t\t\t\t\t\t\t\t<textarea class="WEB_format_area" placeholder="'+this.settings.textConf.placeholder+'"></textarea>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="WEB_format_message"></div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>';$(this).html(e),methods._createFormatEvents.call(this)}},_createFormatEvents:function(){var t=$(this).find(".WEB_format_area"),e=$(this).find(".WEB_format_tree"),s=$(this).find(".WEB_format_message"),a=this;$(this).off(".format").on("click.format",".actionBtn",function(){if($(this).hasClass("empty"))t.val(""),e.html(""),s.html("");else{var r=t.val(),n=!!$(this).hasClass("compress"),i=methods._checkOutJson.call(a,r);if("object"!==$.type(i))return;$(this).hasClass("treeView")?methods._createTreeView.call(a,i.data):methods._formatData.call(a,i.data,n)}}),t.on("input keyup",function(){var e=t.val(),s=methods._checkOutJson.call(a,e);"object"===$.type(s)&&methods._createTreeView.call(a,s.data)})},_formatData:function(t,e){for(var s="",a=0;a<this.settings.indentClass;a++)s+=" ";var r=[],n=this.settings.lineBreak,i=0,o=0,c=$(this).find(".WEB_format_message"),l=$(this).find(".WEB_format_area");e&&(n=s="");var f=function(t,e,a,c,l){i++;for(var h=0,m="";h<c;h++)m+=s;if(o=++c,"array"===$.type(e)){r.push(m+(l?'"'+t+'":':"")+"["+n);for(var h=0;h<e.length;h++)f(h,e[h],h==e.length-1,c,!1);r.push(m+"]"+(a?n:","+n))}else if("object"===$.type(e)){r.push(m+(l?'"'+t+'":':"")+"{"+n);var d=0,h=0;for(var p in e)d++;for(var p in e)f(p,e[p],++h==d,c,!0);r.push(m+"}"+(a?n:","+n))}else"string"==$.type(e)&&(e='"'+e+'"'),r.push(m+(l?'"'+t+'":':"")+e+(a?"":",")+n)};f("",t,!0,0,!1),c.html("共处理节点<b>"+i+"</b>个,最大树深为<b>"+o+"</b>"),l.val(r.join(""))},_checkOutJson:function(sourceData){var message=$(this).find(".WEB_format_message"),jsonRule=/^\s*(\[\n*(\n*.*)*\n*\]|\{\n*(\n*.*)*\n*\})\s*$/g;if(""===sourceData)return message.html("数据不能为空！"),!1;if(!jsonRule.test(sourceData))return message.html("数据格式不匹配！"),!1;message.html("");try{var resultData=eval("("+sourceData+")")}catch(t){return message.html("数据格式化出错！"),!1}return message.html(""),{result:!0,data:resultData}},_createTreeView:function(t){var e=[],s=this,a=0,r=0,n=function(t,i,o,c){a++,r=++c;var l=0;if("root"===t&&e.push('<ul class="root-tree"><li class="root-tree-items">','<div class="node-name">'+methods._createTreeIcon.call(s,t,i,o,c)+"</div>"),"array"===$.type(i)?l=i.length:"object"===$.type(i)&&$.each(i,function(){l++}),"object"==typeof i){e.push('<ul class="node-tree">');var f=0,h=!1;$.each(i,function(t,a){"array"===$.type(i)?h=t===l-1:"object"===$.type(i)&&(f++,h=f===l),"object"==typeof a?e.push('<li class="node-tree-items"><div>'+methods._createTreeIcon.call(s,t,a,h,c)+t+"</div>"):e.push('<li class="node-tree-items">'),n(t,a,h,c),e.push("</li>")}),e.push("</ul>")}else"string"===$.type(i)&&(i='"'+i+'"'),e.push('<div class="node-name">'+methods._createTreeIcon.call(s,t,i,o,c)+'"'+t+'"：'+i+"</div>");"root"===t&&e.push("</li></ul>")};$.isEmptyObject(t)||(n("root",t,!0,0),$(this).find(".WEB_format_tree").html(e.join("")),$(this).find(".WEB_format_message").html("共处理节点<b>"+a+"</b>个,最大树深为<b>"+r+"</b>"))},_createTreeIcon:function(t,e,s,a){var r="",n="",i="",o="",c="";"root"===t&&(r=this.settings.textConf.root),"array"===$.type(e)?(o='<span class="tree-icon tree-icon-array"></span>',i='<span class="tree-icon tree-icon-close"></span>'):"object"===$.type(e)?(o='<span class="tree-icon tree-icon-object"></span>',i='<span class="tree-icon tree-icon-close"></span>'):o="number"===$.type(e)||"function"===$.type(e)?'<span class="tree-icon tree-icon-number"></span>':'<span class="tree-icon tree-icon-default"></span>';for(var l=0;l<a;l++)if("root"!==t){var f="tree-icon";l>0&&(f=s?l===a-1&&"object"!=typeof e?"tree-icon tree-icon-end":"tree-icon tree-icon-line":l===a-1&&"object"!=typeof e?"tree-icon tree-icon-join":"tree-icon tree-icon-line"),c+='<span class="'+f+'"></span>'}return n=c+i+o+r}};$.fn.WEB_format=function(){var t="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"");if("MSIE7.0"==t||"MSIE6.0"==t||"MSIE5.0"==t)return void alert("您的浏览器版本过低，本插件无法提供支持，请升级！");var e,s=arguments[0];if(methods[s]&&"_"!=s.charAt(0))s=methods[s],e=Array.prototype.slice.call(arguments,1);else{if("object"!=typeof s&&s)return $.error("方法未正确调用"),this;s=methods.init,e=arguments}return s.apply(this,e)}}(jQuery,window,document);