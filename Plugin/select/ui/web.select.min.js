!function($,window,document,undefined){var defaults={trigger:"click",isEdit:!0,beforeShow:function(){},afterShow:function(){},beforeHide:function(){},afterHide:function(){},onSelect:function(){},isMultiple:!1,isDestroy:!1,isValueSort:!0,formatTemplate:"1",dataPool:"",param:{},isRemoteFilter:!1,indentX:10,separator:"|",showOptions:!1,baseNumber:10,scrollRate:1,pagerType:"local",formatData:function(e){}},methods={init:function(e){return this.each(function(){var t=$(this).data("WEB_selectMenu_settings");t?this.settings=$.extend(!0,{},t,e):(this.settings=$.extend(!0,{},defaults,e),$(this).data("WEB_selectMenu_settings",this.settings)),methods._createSelectContainer.call(this)})},_createSelectContainer:function(){methods._initSelectContainer.call(this),methods._createTriangle.call(this)},_initSelectContainer:function(){var e=$("#WEB_selectMenu_container");0==e.length&&(e=$('<div class="WEB_selectMenu_container" id="WEB_selectMenu_container"></div>'),e.appendTo($("body"))),e.css({display:"none"}),methods._createContainerEvent.call(this)},_getSelectMenuData:function(){var e=this,t=this.settings.dataPool,s=/\[\{.*\}\]/gi,i=/^((https|http)?:\/\/)[^\s]+/gi,n=$("#WEB_selectMenu_container");t&&("string"==typeof t?"#"==t.charAt(0)||"."==t.charAt(0)?(t=$(t).val()||$(t).html(),t=$.parseJSON(t),methods._processData.call(e,t)):s.test(t)?(t=$.parseJSON(t),methods._processData.call(e,t)):t.indexOf("/")!=-1&&i.test(t)&&(n.is(":hidden")||methods._getRemoteData.call(e)):$.isArray(t)&&(t=t,methods._processData.call(e,t)))},_filterSelectMenuData:function(e,t){var s=(t-1)*this.settings.baseNumber,i=(t-1)*this.settings.baseNumber+(this.settings.baseNumber-1),n=e.slice(s,i+1);return n},_position:function(){var e=$("#WEB_selectMenu_container"),t=$(this).offset().left,s=$(this).offset().top,i=$(this).outerHeight(),n=$(this).outerWidth()-2*parseInt(e.css("borderLeftWidth"))||0,l=parseInt($(this).css("borderTopWidth"))||parseInt($(this).css("borderBottomWidth"))||0;e.css({width:n,left:t,top:s+i-l}),methods._setTrianglePosition.call(this)},_createContainerEvent:function(){var e=this,t="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,""),s="input";"MSIE8.0"==t?s="mousedown keyup":"MSIE9.0"==t&&(s="input keyup"),$(this).off(e.settings.trigger).on(e.settings.trigger,function(t){return t.preventDefault(),"focus"!=e.settings.trigger&&"click"!=e.settings.trigger?void $.error("该组件仅支持focus和click事件！"):(t.stopPropagation(),void($(this).hasClass("WEB_select_current")?methods._closeSelectMenu.call(this):methods._openSelectMenu.call(this)))}).on(s,function(e){("mousedown"==e.type&&3==e.which||"input"==e.type||"keyup"==e.type)&&($(this).hasClass("WEB_select_current")||methods._openSelectMenu.call(this))}),$(document).click(function(t){methods._closeSelectMenu.call(e)})},_renderSelectMenu:function(e,t,s){var i=$("#WEB_selectMenu_container"),n="",l=$(this).val(),a=s;if(t&&0!=t.length){if("init"==e&&""!=l&&l.indexOf(this.settings.separator)==-1){var o=methods._matchKeywords.call(this,l,s);o.length>0?(a=o,n=methods._createSelectTemplate.call(this,o,!0)):n=methods._createSelectTemplate.call(this,t,!0)}else n=methods._createSelectTemplate.call(this,t,!0);i.html(n),$.isFunction(this.settings.afterShow)&&this.settings.afterShow.call(this),methods._position.call(this),methods._initSelectClass.call(this,s),methods._bindSelectListEvent.call(this);var c=i.find(".WEB_selectMenu_list:first").outerHeight(!0),r=this.settings.baseNumber>10?10:this.settings.baseNumber,h=c*r;i.css("maxHeight",h),e&&"filter"==e&&(a=t),a&&a.length>r&&methods._createScroller.call(this,a)}},_openSelectMenu:function(){$.isFunction(this.settings.beforeShow)&&this.settings.beforeShow.call(this);var e=$("#WEB_selectMenu_container"),t=this;e.off("mousewheel").css("display","block").html('<div class="WEB_selectMenu_loading"></div>'),$(".WEB_select_current").removeClass("WEB_select_current"),$(this).addClass("WEB_select_current"),$(".WEB_selectIndent_active").removeClass("WEB_selectIndent_active"),this.indent.addClass("WEB_selectIndent_active"),methods._position.call(this),methods._getSelectMenuData.call(this),$(window).on("resize",function(){methods._position.call(t)})},_bindSelectListEvent:function(){var e=$("#WEB_selectMenu_container"),t=$(this),s=this;e.off("click").on("click",".WEB_selectMenu_list",function(e){if(s.settings.isMultiple){e.stopPropagation();var i=$(this).hasClass("WEB_selectMenu_list_active");i?$(this).removeClass("WEB_selectMenu_list_active"):$(this).addClass("WEB_selectMenu_list_active")}else $(this).addClass("WEB_selectMenu_list_active").siblings(".WEB_selectMenu_list").removeClass("WEB_selectMenu_list_active");methods._setSelectedValue.call(s,t)}).on("click",".WEB_selectMenu_options",function(e){e.stopPropagation()}).on("click",".select_no_items",function(){methods._closeSelectMenu.call(s),t.val("").removeAttr("code title")}).on("click",".select_all_items",function(){methods._setSelectedValue.call(s,t)}).on("click",".select_close_items",function(){methods._closeSelectMenu.call(s)})},_closeSelectMenu:function(){$(this).hasClass("WEB_select_current")&&($.isFunction(this.settings.beforeHide)&&this.settings.beforeHide.call(this),$("#WEB_selectMenu_container").html("").css({display:"none"}).off("mousewheel"),this.indent.removeClass("WEB_selectIndent_active"),$(this).removeClass("WEB_select_current"),$.isFunction(this.settings.afterHide)&&this.settings.afterHide.call(this),methods._setTrianglePosition.call(this))},_createTriangle:function(){var e=this,t=$(this);this.indent=$('<div class="WEB_selectIndent"></div>'),this.indent.appendTo($("body")),methods._setTrianglePosition.call(this),this.indent.off("click").on("click",function(s){t.hasClass("WEB_select_current")?methods._closeSelectMenu.call(e):methods._openSelectMenu.call(e),s.preventDefault(),s.stopPropagation()}),$(window).on("resize",function(){methods._setTrianglePosition.call(e)})},_setTrianglePosition:function(){var e=$(this).offset().left,t=$(this).offset().top,s=$(this).outerHeight(),i=$(this).outerWidth(),n=this.indent.outerWidth(),l=this.indent.outerHeight();this.indent.css({left:e+i-n-this.settings.indentX,top:t+(s-l)/2})},_initSelectClass:function(){var e=$(this).val(),t=this,s=$("#WEB_selectMenu_container .WEB_selectMenu_list"),i=e.split(this.settings.separator),n=i[0];s.removeClass("WEB_selectMenu_list_active"),t.settings.isMultiple?$.each(i,function(e,t){n=t,s.each(function(){var e=$(this).text();e.toLowerCase()==n.toLowerCase()&&$(this).addClass("WEB_selectMenu_list_active")})}):s.each(function(){var e=$(this).text();e.toLowerCase()==n.toLowerCase()&&$(this).addClass("WEB_selectMenu_list_active")})},_createScroller:function(e){var t,s=$("#WEB_selectMenu_scroller"),i=$("#WEB_selectMenu_container"),n=0,l=0,a=parseInt(i.css("maxHeight"));if(0==s.length&&(s=$('<div class="WEB_selectMenu_scroller" id="WEB_selectMenu_scroller"><div class="scroller_slider"></div></div>'),s.appendTo(i)),this.settings.isMultiple&&this.settings.showOptions){var o=$("#WEB_selectMenu_container .WEB_selectMenu_options").outerHeight();l=.95*(a-o),n=(a-o-l)/2}else l=.95*a,n=(a-l)/2;var c=this.settings.baseNumber/e.length,r=$("#WEB_selectMenu_scroller .scroller_slider"),h=c*l<=30?30:c*l,u=(s.width()-r.width())/2;r.css({height:h,top:0,left:u});var _=(r.outerWidth()-s.outerWidth())/2;t=0==_?2:_<0?-_:_,s.css({height:l,top:n,right:t}),s.on("click",".scroller_slider",function(e){e.stopPropagation()}),methods._bindScrollEvent.call(this,e)},_bindScrollEvent:function(e){var t,s=this,i=$("#WEB_selectMenu_container"),n=$("#WEB_selectMenu_container .WEB_selectMenu"),l=$("#WEB_selectMenu_container .WEB_selectMenu_list:first").outerHeight(!0),a=$("#WEB_selectMenu_scroller .scroller_slider"),o=!1,c=0,r=0,h=a.parent().height()-a.height();a.mousedown(function(e){return o=!0,t=e.clientY-$(this).position().top,this.setCapture&&this.setCapture(),c=$(this).position().top,!1}),$(document).mousemove(function(i){if(o){r=a.position().top;var n=i.clientY-t;return n<0?n=0:n>h&&(n=h),a.css({top:n}),methods._scroller.call(s,n/h,c-r,e),!1}}),$(document).mouseup(function(e){o=!1,e.cancelBubble=!0}),e.length>s.settings.baseNumber?i.off("mousewheel").on("mousewheel",function(t){t.preventDefault();var o,c=t.deltaY,r=c*s.settings.scrollRate*l,u=$("#WEB_selectMenu_container .WEB_selectMenu").position().top,_=0;u+=r,_=s.settings.isMultiple&&s.settings.showOptions?n.height()-i.height()+$("#WEB_selectMenu_container .WEB_selectMenu_options").outerHeight():n.height()-i.height(),c<0?Math.abs(u)>=_&&(u=-_):u>=0&&(u=0),n.css({top:u}),o=u/_,a.css({top:-h*o}),c<0&&e.length>s.settings.baseNumber&&methods._createPagination.call(s,e)}):i.off("mousewheel")},_scroller:function(e,t,s){var i=0,n=$("#WEB_selectMenu_container"),l=$("#WEB_selectMenu_container .WEB_selectMenu");i=this.settings.isMultiple&&this.settings.showOptions?l.height()-n.height()+$("#WEB_selectMenu_container .WEB_selectMenu_options").outerHeight():l.height()-n.height(),l.css({top:-e*i}),t<0&&s.length>this.settings.baseNumber&&methods._createPagination.call(this,s)},_filterKeywords:function(e){var t=this,s=[],i=$(this).val();""==i||""!=i&&i.indexOf(this.settings.separator)>-1?methods._renderSelectMenu.call(t,"init",e,e):(s=methods._matchKeywords.call(this,i,e),$("#WEB_selectMenu_container").off("mousewheel"),s.length>0?methods._renderSelectMenu.call(t,"filter",s,e):methods._renderSelectMenu.call(t,"init",e,e));var n=i.split(t.settings.separator);$(this).attr({code:n,title:i}),$.isFunction(this.settings.onSelect)&&this.settings.onSelect.call(this,this.settings.isMultiple?n:i)},_createPagination:function(e){var t=$("#WEB_selectMenu_container"),s=$("#WEB_selectMenu_container .WEB_selectMenu"),i=$("#WEB_selectMenu_container .WEB_selectMenu_list"),n=i.length,l=Math.ceil(n/this.settings.baseNumber),a=Math.ceil(e.length/this.settings.baseNumber);if(l!=a){var o=i.last(),c=parseInt(t.css("maxHeight"))+Math.abs(parseInt(s.css("top"))),r=o.position().top;if(this.settings.showOptions&&(c-=$("#WEB_selectMenu_container .WEB_selectMenu_options").outerHeight()),r<=c){l+=1;var h=(l-1)*this.settings.baseNumber,u=(l-1)*this.settings.baseNumber+(this.settings.baseNumber-1),_=e.slice(h,u+1);methods._appendPagerItem.call(this,_)}}},_appendPagerItem:function(e){var t=$("#WEB_selectMenu_container"),s=$("#WEB_selectMenu_container .WEB_selectMenu");t.find(".WEB_selectMenu_list_wait").remove(),t.append($('<div class="WEB_selectMenu_list_wait"></div>')),methods._setWaitIconPosition.call(this);var i=methods._createSelectTemplate.call(this,e,!1);s.append(i),setTimeout(function(){t.find(".WEB_selectMenu_list_wait").remove()},300),methods._initSelectClass.call(this)},_getRemoteData:function(){var e=this,t=$("#WEB_selectMenu_container");this.settings.param.url=this.settings.dataPool,$.ajax(e.settings.param).done(function(s){s&&s.length>0?methods._processData.call(e,s):t.html('<div class="WEB_select_noResult">没有数据！</div>')}).fail(function(e){var s="错误码:"+e.status+"&nbsp;"+e.statusText;t.html('<div class="WEB_select_error">'+s+"</div>")})},_processData:function(e){var t=this.settings.formatData(e)||e,s=[],i=this;if("local"==this.settings.pagerType){var n=1;s=methods._filterSelectMenuData.call(this,t,n)}else""==this.settings.pagerType&&(s=t);if(methods._renderSelectMenu.call(this,"init",s,t),!this.settings.isRemoteFilter){var l="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,""),a="MSIE8.0"==l||"MSIE9.0"==l?"keyup.filter":"input.filter";$(this).off(".filter").on(a,function(e){methods._filterKeywords.call(i,t),e.stopPropagation()})}},_setSelectedValue:function(e){var t=$("#WEB_selectMenu_container"),s=[],i=[];e.val("").removeAttr("code title");var n=t.find(".WEB_selectMenu_list_active");n.each(function(){var e=$(this).text(),t=$(this).attr("code");$.inArray(e,s)<0&&s.push(e),$.inArray(t,i)<0&&i.push(t)}),0==s.length&&methods._openSelectMenu.call(this),this.settings.isValueSort&&(s=methods._sortSelectedValue(s),i=methods._sortSelectedValue(i)),e.val(s.join(this.settings.separator)).attr({code:i,title:s.join(this.settings.separator)}),$.isFunction(this.settings.onSelect)&&this.settings.onSelect.call(this,this.settings.isMultiple?i:0==i.length?"":i.toString())},_sortSelectedValue:function(e){var t=[],s=[];return $.each(e,function(e,i){$.isNumeric(i)?t.push(i):s.push(i)}),t.length>0&&(t=t.sort(function(e,t){return e-t})),s=s.sort(function(e,t){return e.charAt(0).localeCompare(t.charAt(0))}),s.concat(t)},_setWaitIconPosition:function(){var e=$("#WEB_selectMenu_container"),t=$(".WEB_selectMenu_list_wait"),s=e.width(),i=e.height(),n=t.width(),l=t.height(),a=(s-n)/2,o=(i-l)/2;t.css({left:a,top:o})},_createSelectTemplate:function(e,t){var s="",i="",n="";return"1"==this.settings.formatTemplate?i="":"2"==this.settings.formatTemplate&&(i=this.settings.isMultiple?'<span class="multipleIcon"></span>':'<span class="radioIcon"></span>'),$.each(e,function(e,t){n+='<li class="WEB_selectMenu_list" title="'+t.name+'" code="'+t.code+'">'+i+t.name+"</li>"}),s=t?this.settings.showOptions&&this.settings.isMultiple?'<ul class="WEB_selectMenu">'+n+'</ul><div class="WEB_selectMenu_options"><span class="select_btn select_all_items">全选</span><span class="select_btn select_close_items">关闭</span><span class="select_btn select_no_items">取消</span></div>':'<ul class="WEB_selectMenu">'+n+"</ul>":n},_matchKeywords:function(targetStr,data){var filterData=[];return $.each(data,function(i,D){var Name=""+D.name;Name=Name.toLowerCase(),targetStr=targetStr.toLowerCase(),targetStr=$.trim(targetStr);var testRule=eval("/^"+targetStr+"+/gi");testRule.test(Name)&&filterData.push(D)}),filterData}};$.fn.WEB_selectMenu=function(){var e="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"");if("MSIE7.0"==e||"MSIE6.0"==e||"MSIE5.0"==e)return void alert("您的浏览器版本过低，本插件无法提供支持，请升级！");var t,s=arguments[0];if(methods[s]&&"_"!=s.charAt(0))s=methods[s],t=Array.prototype.slice.call(arguments,1);else{if("object"!=typeof s&&s)return $.error("方法未正确调用"),this;s=methods.init,t=arguments}return s.apply(this,t)}}(jQuery,window,document);