!function(e,t,s,i){var n={trigger:"click",isEdit:!0,beforeShow:function(){},afterShow:function(){},beforeHide:function(){},afterHide:function(){},onSelect:function(){},valueField:"code",textField:"name",isMultiple:!1,isValueSort:!0,formatTemplate:"1",dataSource:"",initFilter:!1,param:function(e){return{type:"POST",timeout:4e4,data:{keywords:""}}},isRemoteFilter:!1,isRemotePager:!1,indentX:10,separator:"|",showOptions:!1,baseNumber:10,scrollRate:1,pagerType:"local",formatData:function(e){}},l={init:function(t){return this.each(function(){var s=e(this).data("WEB_selectMenu_settings");s?this.settings=e.extend(!0,{},s,t):(this.settings=e.extend(!0,{},n,t),e(this).data("WEB_selectMenu_settings",this.settings)),l._createSelectContainer.call(this)})},_createSelectId:function(){this.uid||(this.uid="select"+1e10*Math.random(),this.uid=this.uid.replace(/(.*)\..*/gi,"$1"))},_createSelectContainer:function(){if(l._createSelectId.call(this),l._initSelectField.call(this),l._initSelectContainer.call(this),l._createSelectIdent.call(this),this.settings.isRemoteFilter){var t=this,s="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,""),i="MSIE8.0"==s||"MSIE9.0"==s?"keyup.filter":"input.filter";e(this).off(".filter").on(i,function(e){l._remoteFilterKeywords.call(t)})}},_initSelectField:function(){e(this).addClass("WEB_select_field"),e(this).attr("selectId")||e(this).attr("selectId",this.uid),this.settings.isEdit?e(this).removeAttr("readonly"):e(this).prop("readonly",!0)},_initSelectContainer:function(){var t=e("#WEB_selectMenu_container");0==t.length&&(t=e('<div class="WEB_selectMenu_container" id="WEB_selectMenu_container"></div>'),t.appendTo(e("body"))),l._createContainerEvent.call(this)},_createContainerEvent:function(){var t=this,i="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,""),n="input";"MSIE8.0"==i?n="mousedown keyup":"MSIE9.0"==i&&(n="input keyup"),e(this).off(t.settings.trigger).on(t.settings.trigger,function(s){return s.preventDefault(),"focus"!=t.settings.trigger&&"click"!=t.settings.trigger?void e.error("该组件仅支持focus和click事件！"):(s.stopPropagation(),void(e(this).hasClass("WEB_select_current")?l._closeSelectMenu.call(t):l._openSelectMenu.call(t)))}).on(n,function(s){("mousedown"==s.type&&3==s.which||"input"==s.type||"keyup"==s.type)&&(e(this).hasClass("WEB_select_current")||l._openSelectMenu.call(t))}),e(s).click(function(e){l._closeSelectMenu.call(t)})},_createSelectIdent:function(){var s=this,i=e(this);this.indent=e('<div class="WEB_selectIndent"></div>'),this.indent.attr("targetId",s.uid),0==e(".WEB_selectIndent[targetid="+s.uid+"]").length&&this.indent.appendTo(e("body")),l._setSelectIdentPosition.call(this),this.indent.off("click").on("click",function(e){i.hasClass("WEB_select_current")?l._closeSelectMenu.call(s):l._openSelectMenu.call(s),e.preventDefault(),e.stopPropagation()}),e(t).on("resize",function(){l._setSelectIdentPosition.call(s)})},_setSelectIdentPosition:function(){var t=this;e(".WEB_selectIndent").each(function(){var s=e(this).attr("targetId"),i=e("input[selectId="+s+"]");if(i.length>0){var n=i.offset().left,l=i.offset().top,a=i.outerHeight(),c=i.outerWidth(),o=e(this).outerWidth(),r=e(this).outerHeight();e(this).css({left:n+c-o-t.settings.indentX,top:l+(a-r)/2})}})},_openSelectMenu:function(){e.isFunction(this.settings.beforeShow)&&this.settings.beforeShow.call(this);var s=e("#WEB_selectMenu_container"),i=this;s.off("mousewheel").css("display","block").html('<div class="WEB_selectMenu_loading"></div>'),e(".WEB_select_current").removeClass("WEB_select_current"),e(this).addClass("WEB_select_current"),e(".WEB_selectIndent_active").removeClass("WEB_selectIndent_active"),e(".WEB_selectIndent[targetid="+this.uid+"]").addClass("WEB_selectIndent_active"),l._position.call(this),l._getSelectMenuData.call(this),e(t).on("resize",function(){l._position.call(i)}),l._bindSelectListEvent.call(this)},_closeSelectMenu:function(){e(this).hasClass("WEB_select_current")&&(e(this).removeProp("disabled"),e.isFunction(this.settings.beforeHide)&&this.settings.beforeHide.call(this),e("#WEB_selectMenu_container").html("").css({display:"none"}).off("mousewheel"),e(".WEB_selectIndent[targetid="+this.uid+"]").removeClass("WEB_selectIndent_active"),e(this).removeClass("WEB_select_current"),e.isFunction(this.settings.afterHide)&&this.settings.afterHide.call(this))},_position:function(){var t=e("#WEB_selectMenu_container"),s=e(this).offset().left,i=e(this).offset().top,n=e(this).outerHeight(),a=e(this).outerWidth()-2*parseInt(t.css("borderLeftWidth"))||0,c=parseInt(e(this).css("borderTopWidth"))||parseInt(e(this).css("borderBottomWidth"))||0;t.css({width:a,left:s,top:i+n-c}),l._setSelectIdentPosition.call(this)},_getSelectMenuData:function(){var t=this,s=this.settings.dataSource,i=/\{.*\[\{.*\}\].*\}/gi,n=/^((https|http)?:\/\/)[^\s]+/gi,a=e("#WEB_selectMenu_container");return s?void("string"===e.type(s)?"#"==s.charAt(0)||"."==s.charAt(0)?(s=e(s).val()||e(s).html(),s=e.parseJSON(s),l._processData.call(t,s)):i.test(s)?(s=e.parseJSON(s),l._processData.call(t,s)):s.indexOf("/")!=-1&&n.test(s)&&(a.is(":hidden")||l._loadRemoteData.call(t)):e.isArray(s)&&l._processData.call(t,s)):void a.html('<div class="WEB_select_noResult">没有获取到数据！</div>')},_loadRemoteData:function(t){var s=arguments,i=this,n=e(this),a=e("#WEB_selectMenu_container"),c=this.settings.param(t);if(c.url=this.settings.dataSource,t&&t.page){c.url=this.settings.dataSource;var o=a.find(".WEB_selectMenu_list_wait");0==o.length&&(a.append(e('<div class="WEB_selectMenu_list_wait"></div>')),l._setWaitIconPosition.call(this));e("#WEB_selectMenu_scroller .scroller_slider")}e.ajax(c).done(function(e){if(n.removeProp("disabled"),e.data&&e.data.length>0)if(s.length>0){var t=i.settings.formatData(e)||e;l._localDataHandle.call(i,t)}else l._processData.call(i,e);else a.html('<div class="WEB_select_noResult">没有获取到数据！</div>')}).fail(function(e){n.removeProp("disabled");var t="错误码:"+e.status+"&nbsp;"+e.statusText;a.html('<div class="WEB_select_error">'+t+"</div>")})},_processData:function(t){var s=this.settings.formatData(t)||t,i=this;if(l._localDataHandle.call(this,s),!this.settings.isRemoteFilter){var n="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,""),a="MSIE8.0"==n||"MSIE9.0"==n?"keyup.filter":"input.filter";e(this).off(".filter").on(a,function(e){l._localFilterKeywords.call(i,s)})}},_localDataHandle:function(e){if(e.totalSize>this.settings.baseNumber){var t=e.data.slice(0,10),s={data:t,totalSize:e.totalSize};l._createScroller.call(this,s,e)}else l._renderSelectMenu.call(this,e)},_renderSelectMenu:function(t){var s=e("#WEB_selectMenu_container"),i="",i=l._createSelectTemplate.call(this,t,!0);s.html(i),e.isFunction(this.settings.afterShow)&&this.settings.afterShow.call(this),l._initSelectClass.call(this,t);var n=s.find(".WEB_selectMenu_list:first").outerHeight(!0),a=this.settings.baseNumber>10?10:this.settings.baseNumber,c=n*a;s.css("maxHeight",c)},_createSelectTemplate:function(t,s){var i="",n=this,l="",a="";return"1"==this.settings.formatTemplate?l="":"2"==this.settings.formatTemplate&&(l=this.settings.isMultiple?'<span class="multipleIcon"></span>':'<span class="radioIcon"></span>'),e.each(t.data,function(e,t){a+='<li class="WEB_selectMenu_list" title="'+t[n.settings.textField]+'" code="'+t[n.settings.valueField]+'">'+l+t[n.settings.textField]+"</li>"}),i=s?this.settings.showOptions&&this.settings.isMultiple?'<ul class="WEB_selectMenu">'+a+'</ul><div class="WEB_selectMenu_options"><span class="select_btn select_all_items">全选</span><span class="select_btn select_close_items">关闭</span><span class="select_btn select_no_items">取消</span></div>':'<ul class="WEB_selectMenu">'+a+"</ul>":a},_bindSelectListEvent:function(){var t=e("#WEB_selectMenu_container"),s=e(this),i=this;t.off("click").on("click",".WEB_selectMenu_list",function(t){var s=e(this);if(i.settings.isMultiple){t.stopPropagation();var n=e(this).hasClass("WEB_selectMenu_list_active");n?e(this).removeClass("WEB_selectMenu_list_active"):e(this).addClass("WEB_selectMenu_list_active")}else e(this).addClass("WEB_selectMenu_list_active").siblings(".WEB_selectMenu_list").removeClass("WEB_selectMenu_list_active");l._setSelectedValue.call(i,s)}).on("click",".WEB_selectMenu_options",function(e){e.stopPropagation()}).on("click",".select_no_items",function(){l._closeSelectMenu.call(i),s.val("").removeAttr("code title")}).on("click",".select_all_items",function(){l._setSelectedValue.call(i)}).on("click",".select_close_items",function(){l._closeSelectMenu.call(i)})},_initSelectClass:function(){var t=e(this).val(),s=this,i=e("#WEB_selectMenu_container .WEB_selectMenu_list"),n=t.split(this.settings.separator),l=n[0];i.removeClass("WEB_selectMenu_list_active"),s.settings.isMultiple?e.each(n,function(t,s){l=s,i.each(function(){var t=e(this).text();t.toLowerCase()==l.toLowerCase()&&e(this).addClass("WEB_selectMenu_list_active")})}):i.each(function(){var t=e(this).text();t.toLowerCase()==l.toLowerCase()&&e(this).addClass("WEB_selectMenu_list_active")})},_createScroller:function(t,s){l._renderSelectMenu.call(this,t);var i,n=e("#WEB_selectMenu_scroller"),a=e("#WEB_selectMenu_container"),c=0,o=0,r=parseInt(a.css("maxHeight"));if(0==n.length&&(n=e('<div class="WEB_selectMenu_scroller" id="WEB_selectMenu_scroller"><div class="scroller_slider"></div></div>'),n.appendTo(a)),this.settings.isMultiple&&this.settings.showOptions){var _=e("#WEB_selectMenu_container .WEB_selectMenu_options").outerHeight();o=.95*(r-_),c=(r-_-o)/2}else o=.95*r,c=(r-o)/2;var u=this.settings.baseNumber/s.totalSize,h=e("#WEB_selectMenu_scroller .scroller_slider"),d=u*o<=30?30:u*o,p=(n.width()-h.width())/2;h.css({height:d,top:0,left:p});var f=(h.outerWidth()-n.outerWidth())/2;i=0==f?2:f<0?-f:f,n.css({height:o,top:c,right:i}),n.on("click",".scroller_slider",function(e){e.stopPropagation()}),l._bindScrollEvent.call(this,s)},_bindScrollEvent:function(t){var i,n=this,a=e("#WEB_selectMenu_container"),c=e("#WEB_selectMenu_container .WEB_selectMenu"),o=e("#WEB_selectMenu_container .WEB_selectMenu_list:first").outerHeight(!0),r=e("#WEB_selectMenu_scroller .scroller_slider"),_=!1,u=0,h=0,d=r.parent().height()-r.height();r.off("mousedown").on("mousedown",function(t){return _=!0,i=t.clientY-e(this).position().top,this.setCapture&&this.setCapture(),u=e(this).position().top,!1}),e(s).mousemove(function(e){if(_){h=r.position().top;var s=e.clientY-i;return s<0?s=0:s>d&&(s=d),r.css({top:s}),l._scroller.call(n,s/d,u-h,t),!1}}),e(s).mouseup(function(e){_=!1,e.cancelBubble=!0}),a.off("mousewheel").on("mousewheel",function(s){s.preventDefault();var i,_=s.deltaY,u=_*n.settings.scrollRate*o,h=e("#WEB_selectMenu_container .WEB_selectMenu").position().top,p=0;h+=u,p=n.settings.isMultiple&&n.settings.showOptions?c.height()-a.height()+e("#WEB_selectMenu_container .WEB_selectMenu_options").outerHeight():c.height()-a.height(),_<0?Math.abs(h)>p&&(h=-p):h>=0&&(h=0),c.css({top:h}),i=h/p,r.css({top:-d*i}),l._createPagination.call(n,t)})},_scroller:function(t,s,i){var n=e("#WEB_selectMenu_container .WEB_selectMenu"),a=(n.find(".WEB_selectMenu_list").length,i.totalSize,0),c=e("#WEB_selectMenu_container"),n=e("#WEB_selectMenu_container .WEB_selectMenu");a=this.settings.isMultiple&&this.settings.showOptions?n.height()-c.height()+e("#WEB_selectMenu_container .WEB_selectMenu_options").outerHeight():n.height()-c.height(),n.css({top:-t*a}),s<0&&l._createPagination.call(this,i)},_localFilterKeywords:function(t){var s=this,i={},n=e(this).val(),a={keywords:n};if(this.settings.param(a),""==n||""!=n&&n.indexOf(this.settings.separator)>-1)l._localDataHandle.call(s,t);else{e("#WEB_selectMenu_container").off("mousewheel");var i=l._matchKeywords.call(this,n,t);0==i.data.length?e("#WEB_selectMenu_container").html('<div class="WEB_select_noResult">没有搜索到数据！</div>'):l._localDataHandle.call(s,i)}var c=n.split(s.settings.separator);e(this).attr({code:c,title:n}),e.isFunction(this.settings.onSelect)&&this.settings.onSelect.call(this,c,c)},_remoteFilterKeywords:function(){var t=e(this).val();""!=t?l._loadRemoteData.call(this,{keywords:t}):l._loadRemoteData.call(this)},_createPagination:function(t){var s=e("#WEB_selectMenu_container"),i=e("#WEB_selectMenu_container .WEB_selectMenu"),n=e("#WEB_selectMenu_container .WEB_selectMenu_list"),a=n.length,c=Math.ceil(a/this.settings.baseNumber),o=Math.ceil(t.totalSize/this.settings.baseNumber);if(c!=o){var r=n.last(),_=parseInt(s.css("maxHeight"))+Math.abs(parseInt(i.css("top"))),u=r.position().top;if(this.settings.showOptions&&(_-=e("#WEB_selectMenu_container .WEB_selectMenu_options").outerHeight()),u<=_)if(c+=1,this.settings.isRemotePager)l._loadRemoteData.call(this,{page:c});else{var h=(c-1)*this.settings.baseNumber,d=(c-1)*this.settings.baseNumber+(this.settings.baseNumber-1),p={data:t.data.slice(h,d+1)};l._appendPagerItem.call(this,p)}}},_appendPagerItem:function(t){var s=e("#WEB_selectMenu_container"),i=e("#WEB_selectMenu_container .WEB_selectMenu");s.find(".WEB_selectMenu_list_wait").remove(),s.append(e('<div class="WEB_selectMenu_list_wait"></div>')),l._setWaitIconPosition.call(this);var n=l._createSelectTemplate.call(this,t,!1);i.append(n),setTimeout(function(){s.find(".WEB_selectMenu_list_wait").remove()},300),l._initSelectClass.call(this)},_setSelectedValue:function(t){var s=e("#WEB_selectMenu_container"),i=(e(this),s.find(".WEB_selectMenu_list_active")),n=e(this).val(),a=n.length>0?n.split(this.settings.separator):[],c=e(this).attr("code")?e(this).attr("code"):"",o=c.length>0?c.split(this.settings.separator):[],r=[],_=[];if(this.settings.isMultiple)if(0==arguments.length)i.each(function(){var t=e(this).text(),s=e(this).attr("code");e.inArray(t,r)<0&&r.push(t),e.inArray(s,_)<0&&_.push(s)});else{var u=t.text(),h=e.inArray(u,a),d=t.attr("code");t.hasClass("WEB_selectMenu_list_active")?h<0&&(a.push(u),o.push(d)):h>=0&&(a.splice(h,1),o.splice(h,1)),r=a.concat([]),_=o.concat([]),console.log(_)}else e(this).val("").removeAttr("code title"),r.push(t.text()),_.push(t.attr("code"));0==r.length&&l._openSelectMenu.call(this),this.settings.isValueSort&&(r=l._sortSelectedValue(r),_=l._sortSelectedValue(_));var p=r.join(this.settings.separator),f=_.join(this.settings.separator);e(this).val(p).attr({code:f,title:p}),e.isFunction(this.settings.onSelect)&&this.settings.onSelect.call(this,r,_)},_sortSelectedValue:function(t){var s=[],i=[];return e.each(t,function(t,n){e.isNumeric(n)?s.push(n):i.push(n)}),s.length>0&&(s=s.sort(function(e,t){return e-t})),i=i.sort(function(e,t){return e.charAt(0).localeCompare(t.charAt(0))}),i.concat(s)},_setWaitIconPosition:function(){var t=e("#WEB_selectMenu_container"),s=e(".WEB_selectMenu_list_wait"),i=t.width(),n=t.height(),l=s.width(),a=s.height(),c=(i-l)/2,o=(n-a)/2;s.css({left:c,top:o})},_matchKeywords:function(t,s){var i=[],n=Date.now();e.each(s.data,function(s,n){var l=""+n.name;l=l.toLowerCase(),t=e.trim(t.toLowerCase());var a=new RegExp("^"+t,"gi");a.test(l)&&i.push(n)});var l=Date.now();return console.log("筛选用时："+(l-n)/1e3+"秒"),{data:i,totalSize:i.length}}};e.fn.WEB_selectMenu=function(){var t="Microsoft Internet Explorer"==navigator.appName&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"");if("MSIE7.0"==t||"MSIE6.0"==t||"MSIE5.0"==t)return void alert("您的浏览器版本过低，本插件无法提供支持，请升级！");var s,i=arguments[0];if(l[i]&&"_"!=i.charAt(0))i=l[i],s=Array.prototype.slice.call(arguments,1);else{if("object"!=typeof i&&i)return e.error("方法未正确调用"),this;i=l.init,s=arguments}return i.apply(this,s)}}(jQuery,window,document);